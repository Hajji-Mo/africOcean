import{an as c,au as d,aC as m,al as p,aD as g,r as _,aE as l,aF as h,aG as v,aH as x,j as u,aI as C,aJ as D}from"./index-Dol8Qyia.js";import{l as E}from"./index-1HjZlvs3.js";let s;const S="http://localhost:5000",j=t=>{s=E(S,{query:`user_id=${t}`})};function I(){const t=c(d),{conversations:r,currentConversation:i}=c(m),o=p(),f=g();return _.useEffect(()=>{if(t)return s||j(t._id),s.on("start_chat",e=>{const a=r.find(n=>(n==null?void 0:n.id)===e._id);o(a?l({conversation:e}):h({conversation:e})),o(v({chatId:e._id}))}),s.on("new_message",e=>{const a=e.message;(i==null?void 0:i.id)===e.conversation_id&&o(x({id:a._id,type:"msg",subtype:a.type,message:a.text,incoming:a.to===t._id,outgoing:a.from===t._id}))}),()=>{s==null||s.off("start_chat"),s==null||s.off("new_message")}},[r,i,o,t]),t?u.jsx(C,{}):u.jsx(D,{to:"/SignIn",state:{from:f},replace:!0})}export{I as default};
